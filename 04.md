# Gateway

* https://istio.io/latest/zh/docs/reference/config/networking/gateway/

`Gateway` describes a load balancer operating at the edge of the mesh receiving incoming or outgoing HTTP/TCP connections. The specification describes a set of ports that should be exposed, the type of protocol to use, SNI configuration for the load balancer, etc.
网关描述了在网格边缘运行的负载均衡器，接收传入或传出的 HTTP/TCP 连接。该规范描述了一组应公开的端口、要使用的协议类型、负载均衡器的 SNI 配置等。

For example, the following Gateway configuration sets up a proxy to act as a load balancer exposing port 80 and 9080 (http), 443 (https), 9443(https) and port 2379 (TCP) for ingress. The gateway will be applied to the proxy running on a pod with labels `app: my-gateway-controller`. While Istio will configure the proxy to listen on these ports, it is the responsibility of the user to ensure that external traffic to these ports are allowed into the mesh.
例如，以下网关配置设置代理作为负载均衡器，公开端口 80 和 9080 (http)、443 (https)、9443(https) 和端口 2379 (TCP) 用于入口。该网关将应用于在带有标签 app: my-gateway-controller 的 pod 上运行的代理。虽然 Istio 将配置代理来侦听这些端口，但用户有责任确保允许到这些端口的外部流量进入网格。

v1alpha3

```yaml
apiVersion: networking.istio.io/v1alpha3
kind: Gateway
metadata:
  name: my-gateway
  namespace: some-config-namespace
spec:
  selector:
    app: my-gateway-controller
  servers:
  - port:
      number: 80
      name: http
      protocol: HTTP
    hosts:
    - uk.bookinfo.com
    - eu.bookinfo.com
    tls:
      httpsRedirect: true # sends 301 redirect for http requests
  - port:
      number: 443
      name: https-443
      protocol: HTTPS
    hosts:
    - uk.bookinfo.com
    - eu.bookinfo.com
    tls:
      mode: SIMPLE # enables HTTPS on this port
      serverCertificate: /etc/certs/servercert.pem
      privateKey: /etc/certs/privatekey.pem
  - port:
      number: 9443
      name: https-9443
      protocol: HTTPS
    hosts:
    - "bookinfo-namespace/*.bookinfo.com"
    tls:
      mode: SIMPLE # enables HTTPS on this port
      credentialName: bookinfo-secret # fetches certs from Kubernetes secret
  - port:
      number: 9080
      name: http-wildcard
      protocol: HTTP
    hosts:
    - "*"
  - port:
      number: 2379 # to expose internal service via external port 2379
      name: mongo
      protocol: MONGO
    hosts:
    - "*"
```

v1beta1

```yaml
apiVersion: networking.istio.io/v1beta1
kind: Gateway
metadata:
  name: my-gateway
  namespace: some-config-namespace
spec:
  selector:
    app: my-gateway-controller
  servers:
  - port:
      number: 80
      name: http
      protocol: HTTP
    hosts:
    - uk.bookinfo.com
    - eu.bookinfo.com
    tls:
      httpsRedirect: true # sends 301 redirect for http requests
  - port:
      number: 443
      name: https-443
      protocol: HTTPS
    hosts:
    - uk.bookinfo.com
    - eu.bookinfo.com
    tls:
      mode: SIMPLE # enables HTTPS on this port
      serverCertificate: /etc/certs/servercert.pem
      privateKey: /etc/certs/privatekey.pem
  - port:
      number: 9443
      name: https-9443
      protocol: HTTPS
    hosts:
    - "bookinfo-namespace/*.bookinfo.com"
    tls:
      mode: SIMPLE # enables HTTPS on this port
      credentialName: bookinfo-secret # fetches certs from Kubernetes secret
  - port:
      number: 9080
      name: http-wildcard
      protocol: HTTP
    hosts:
    - "*"
  - port:
      number: 2379 # to expose internal service via external port 2379
      name: mongo
      protocol: MONGO
    hosts:
    - "*"
```

The Gateway specification above describes the L4-L6 properties of a load balancer. A `VirtualService` can then be bound to a gateway to control the forwarding of traffic arriving at a particular host or gateway port.
上面的网关规范描述了负载均衡器的 L4-L6 属性。 然后，可以将 VirtualService 绑定到网关，以控制到达特定主机或网关端口的流量的转发。

For example, the following VirtualService splits traffic for `https://uk.bookinfo.com/reviews`, `https://eu.bookinfo.com/reviews`, `http://uk.bookinfo.com:9080/reviews`, `http://eu.bookinfo.com:9080/reviews` into two versions (prod and qa) of an internal reviews service on port 9080. In addition, requests containing the cookie “user: dev-123” will be sent to special port 7777 in the qa version. The same rule is also applicable inside the mesh for requests to the “reviews.prod.svc.cluster.local” service. This rule is applicable across ports 443, 9080. Note that `http://uk.bookinfo.com` gets redirected to `https://uk.bookinfo.com` (i.e. 80 redirects to 443).
例如，以下 VirtualService 拆分 https://uk.bookinfo.com/reviews、https://eu.bookinfo.com/reviews、http://uk.bookinfo.com:9080/reviews、http://uk.bookinfo.com/reviews、http://uk.bookinfo.com/reviews 的流量 /eu.bookinfo.com:9080/reviews 在端口 9080 上分为内部评论服务的两个版本（prod 和 qa）。此外，包含 cookie“user: dev-123”的请求将被发送到 质量保证版本。 同样的规则也适用于网格内部对“reviews.prod.svc.cluster.local”服务的请求。 此规则适用于端口 443、9080。请注意，http://uk.bookinfo.com 会重定向到 https://uk.bookinfo.com（即 80 重定向到 443）。

v1alpha3

```yaml
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: bookinfo-rule
  namespace: bookinfo-namespace
spec:
  hosts:
  - reviews.prod.svc.cluster.local
  - uk.bookinfo.com
  - eu.bookinfo.com
  gateways:
  - some-config-namespace/my-gateway
  - mesh # applies to all the sidecars in the mesh
  http:
  - match:
    - headers:
        cookie:
          exact: "user=dev-123"
    route:
    - destination:
        port:
          number: 7777
        host: reviews.qa.svc.cluster.local
  - match:
    - uri:
        prefix: /reviews/
    route:
    - destination:
        port:
          number: 9080 # can be omitted if it's the only port for reviews
        host: reviews.prod.svc.cluster.local
      weight: 80
    - destination:
        host: reviews.qa.svc.cluster.local
      weight: 20
```

v1beta1

```yaml
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: bookinfo-rule
  namespace: bookinfo-namespace
spec:
  hosts:
  - reviews.prod.svc.cluster.local
  - uk.bookinfo.com
  - eu.bookinfo.com
  gateways:
  - some-config-namespace/my-gateway
  - mesh # applies to all the sidecars in the mesh
  http:
  - match:
    - headers:
        cookie:
          exact: "user=dev-123"
    route:
    - destination:
        port:
          number: 7777
        host: reviews.qa.svc.cluster.local
  - match:
    - uri:
        prefix: /reviews/
    route:
    - destination:
        port:
          number: 9080 # can be omitted if it's the only port for reviews
        host: reviews.prod.svc.cluster.local
      weight: 80
    - destination:
        host: reviews.qa.svc.cluster.local
      weight: 20
```

The following VirtualService forwards traffic arriving at (external) port 27017 to internal Mongo server on port 5555. This rule is not applicable internally in the mesh as the gateway list omits the reserved name `mesh`.
以下 VirtualService 将到达（外部）端口 27017 的流量转发到端口 5555 上的内部 Mongo 服务器。此规则在网格内部不适用，因为网关列表省略了保留名称网格。

v1alpha3

```yaml
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: bookinfo-mongo
  namespace: bookinfo-namespace
spec:
  hosts:
  - mongosvr.prod.svc.cluster.local # name of internal Mongo service
  gateways:
  - some-config-namespace/my-gateway # can omit the namespace if gateway is in same namespace as virtual service.
  tcp:
  - match:
    - port: 27017
    route:
    - destination:
        host: mongo.prod.svc.cluster.local
        port:
          number: 5555
```

v1beta1

```yaml
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: bookinfo-mongo
  namespace: bookinfo-namespace
spec:
  hosts:
  - mongosvr.prod.svc.cluster.local # name of internal Mongo service
  gateways:
  - some-config-namespace/my-gateway # can omit the namespace if gateway is in same namespace as virtual service.
  tcp:
  - match:
    - port: 27017
    route:
    - destination:
        host: mongo.prod.svc.cluster.local
        port:
          number: 5555
```

It is possible to restrict the set of virtual services that can bind to a gateway server using the namespace/hostname syntax in the hosts field. For example, the following Gateway allows any virtual service in the ns1 namespace to bind to it, while restricting only the virtual service with foo.bar.com host in the ns2 namespace to bind to it.
可以使用主机字段中的命名空间/主机名语法来限制可以绑定到网关服务器的虚拟服务集。 例如，以下网关允许 ns1 命名空间中的任何虚拟服务与其绑定，同时限制仅 ns2 命名空间中具有 foo.bar.com 主机的虚拟服务与其绑定。

v1alpha3

```yaml
apiVersion: networking.istio.io/v1alpha3
kind: Gateway
metadata:
  name: my-gateway
  namespace: some-config-namespace
spec:
  selector:
    app: my-gateway-controller
  servers:
  - port:
      number: 80
      name: http
      protocol: HTTP
    hosts:
    - "ns1/*"
    - "ns2/foo.bar.com"
```

v1beta1

```yaml
apiVersion: networking.istio.io/v1beta1
kind: Gateway
metadata:
  name: my-gateway
  namespace: some-config-namespace
spec:
  selector:
    app: my-gateway-controller
  servers:
  - port:
      number: 80
      name: http
      protocol: HTTP
    hosts:
    - "ns1/*"
    - "ns2/foo.bar.com"
```

## Gateway[](https://istio.io/latest/zh/docs/reference/config/networking/gateway/#Gateway)

Gateway describes a load balancer operating at the edge of the mesh receiving incoming or outgoing HTTP/TCP connections.

| Field      | Type                                                                                      | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | Required |
| ---------- | ----------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------- |
| `servers`  | `[Server[]](https://istio.io/latest/zh/docs/reference/config/networking/gateway/#Server)` | A list of server specifications.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | Yes      |
| `selector` | `map<string, string>`                                                                     | One or more labels that indicate a specific set of pods/VMs on which this gateway configuration should be applied. By default workloads are searched across all namespaces based on label selectors. This implies that a gateway resource in the namespace “foo” can select pods in the namespace “bar” based on labels. This behavior can be controlled via the `PILOT_SCOPE_GATEWAY_TO_NAMESPACE` environment variable in istiod. If this variable is set to true, the scope of label search is restricted to the configuration namespace in which the the resource is present. In other words, the Gateway resource must reside in the same namespace as the gateway workload instance. If selector is nil, the Gateway will be applied to all workloads. 一个或多个标签，指示应应用此网关配置的一组特定 Pod/VM。 默认情况下，根据标签选择器在所有命名空间中搜索工作负载。 这意味着命名空间“foo”中的网关资源可以根据标签选择命名空间“bar”中的 Pod。 此行为可以通过 istiod 中的 PILOT_SCOPE_GATEWAY_TO_NAMESPACE 环境变量进行控制。 如果此变量设置为 true，则标签搜索的范围仅限于资源所在的配置命名空间。 换句话说，网关资源必须与网关工作负载实例驻留在同一命名空间中。 如果选择器为零，则网关将应用于所有工作负载。 | Yes      |

## Server[](https://istio.io/latest/zh/docs/reference/config/networking/gateway/#Server)

`Server` describes the properties of the proxy on a given load balancer port. For example,

v1alpha3

```yaml
apiVersion: networking.istio.io/v1alpha3
kind: Gateway
metadata:
  name: my-ingress
spec:
  selector:
    app: my-ingressgateway
  servers:
  - port:
      number: 80
      name: http2
      protocol: HTTP2
    hosts:
    - "*"
```

v1beta1

```yaml
apiVersion: networking.istio.io/v1beta1
kind: Gateway
metadata:
  name: my-ingress
spec:
  selector:
    app: my-ingressgateway
  servers:
  - port:
      number: 80
      name: http2
      protocol: HTTP2
    hosts:
    - "*"
```

Another example

v1alpha3

```yaml
apiVersion: networking.istio.io/v1alpha3
kind: Gateway
metadata:
  name: my-tcp-ingress
spec:
  selector:
    app: my-tcp-ingressgateway
  servers:
  - port:
      number: 27018
      name: mongo
      protocol: MONGO
    hosts:
    - "*"
```

v1beta1

```yaml
apiVersion: networking.istio.io/v1beta1
kind: Gateway
metadata:
  name: my-tcp-ingress
spec:
  selector:
    app: my-tcp-ingressgateway
  servers:
  - port:
      number: 27018
      name: mongo
      protocol: MONGO
    hosts:
    - "*"
```

The following is an example of TLS configuration for port 443

v1alpha3

```yaml
apiVersion: networking.istio.io/v1alpha3
kind: Gateway
metadata:
  name: my-tls-ingress
spec:
  selector:
    app: my-tls-ingressgateway
  servers:
  - port:
      number: 443
      name: https
      protocol: HTTPS
    hosts:
    - "*"
    tls:
      mode: SIMPLE
      credentialName: tls-cert
```

v1beta1

```yaml
apiVersion: networking.istio.io/v1beta1
kind: Gateway
metadata:
  name: my-tls-ingress
spec:
  selector:
    app: my-tls-ingressgateway
  servers:
  - port:
      number: 443
      name: https
      protocol: HTTPS
    hosts:
    - "*"
    tls:
      mode: SIMPLE
      credentialName: tls-cert
```

| Field   | Type                                                                                                          | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | Required |
| ------- | ------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | -------- |
| `port`  | `[Port](https://istio.io/latest/zh/docs/reference/config/networking/gateway/#Port)`                           | The Port on which the proxy should listen for incoming connections.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | Yes      |
| `bind`  | `string`                                                                                                      | The ip or the Unix domain socket to which the listener should be bound to. Format: `x.x.x.x` or `unix:///path/to/uds` or `unix://@foobar` (Linux abstract namespace). When using Unix domain sockets, the port number should be 0. This can be used to restrict the reachability of this server to be gateway internal only. This is typically used when a gateway needs to communicate to another mesh service e.g. publishing metrics. In such case, the server created with the specified bind will not be available to external gateway clients. 侦听器应绑定到的 IP 或 Unix 域套接字。 格式：x.x.x.x 或 unix:///path/to/uds 或 unix://@foobar （Linux 抽象命名空间）。 使用 Unix 域套接字时，端口号应为 0。这可用于限制该服务器的可达性仅限于网关内部。 这通常在网关需要与另一个网格服务通信时使用，例如 发布指标。 在这种情况下，使用指定绑定创建的服务器将不可用于外部网关客户端。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | No       |
| `hosts` | `string[]`                                                                                                    | One or more hosts exposed by this gateway. While typically applicable to HTTP services, it can also be used for TCP services using TLS with SNI. A host is specified as a `dnsName` with an optional `namespace/` prefix. The `dnsName` should be specified using FQDN format, optionally including a wildcard character in the left-most component (e.g., `prod/*.example.com`). Set the `dnsName` to `*` to select all `VirtualService` hosts from the specified namespace (e.g.,`prod/*`).The `namespace` can be set to `*` or `.`, representing any or the current namespace, respectively. For example, `*/foo.example.com` selects the service from any available namespace while `./foo.example.com` only selects the service from the namespace of the sidecar. The default, if no `namespace/` is specified, is `*/`, that is, select services from any namespace. Any associated `DestinationRule` in the selected namespace will also be used.A `VirtualService` must be bound to the gateway and must have one or more hosts that match the hosts specified in a server. The match could be an exact match or a suffix match with the server’s hosts. For example, if the server’s hosts specifies `*.example.com`, a `VirtualService` with hosts `dev.example.com` or `prod.example.com` will match. However, a `VirtualService` with host `example.com` or `newexample.com` will not match.NOTE: Only virtual services exported to the gateway’s namespace (e.g., `exportTo` value of `*`) can be referenced. Private configurations (e.g., `exportTo` set to `.`) will not be available. Refer to the `exportTo` setting in `VirtualService`, `DestinationRule`, and `ServiceEntry` configurations for details. | Yes      |
| `tls`   | `[ServerTLSSettings](https://istio.io/latest/zh/docs/reference/config/networking/gateway/#ServerTLSSettings)` | Set of TLS related options that govern the server’s behavior. Use these options to control if all http requests should be redirected to https, and the TLS modes to use.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | No       |
| `name`  | `string`                                                                                                      | An optional name of the server, when set must be unique across all servers. This will be used for variety of purposes like prefixing stats generated with this name etc.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | No       |

**todo**
One or more hosts exposed by this gateway. While typically applicable to HTTP services, it can also be used for TCP services using TLS with SNI. A host is specified as a dnsName with an optional namespace/ prefix. The dnsName should be specified using FQDN format, optionally including a wildcard character in the left-most component (e.g., prod/*.example.com). Set the dnsName to * to select all VirtualService hosts from the specified namespace (e.g.,prod/*).
此网关公开的一台或多台主机。 虽然通常适用于 HTTP 服务，但它也可用于使用 TLS 和 SNI 的 TCP 服务。 主机被指定为带有可选名称空间/前缀的 dnsName。 dnsName 应使用 FQDN 格式指定，可以选择在最左侧的组件中包含通配符（例如 prod/*.example.com）。 将 dnsName 设置为 * 以从指定命名空间（例如 prod/*）中选择所有 VirtualService 主机。

The namespace can be set to * or ., representing any or the current namespace, respectively. For example, */foo.example.com selects the service from any available namespace while ./foo.example.com only selects the service from the namespace of the sidecar. The default, if no namespace/ is specified, is */, that is, select services from any namespace. Any associated DestinationRule in the selected namespace will also be used.
命名空间可以设置为 * 或 .，分别表示任意命名空间或当前命名空间。 例如， */foo.example.com 从任何可用的命名空间中选择服务，而 ./foo.example.com 仅从 sidecar 的命名空间中选择服务。 如果不指定namespace/，则默认为*/，即从任意命名空间选择服务。 还将使用所选命名空间中任何关联的 DestinationRule。

A VirtualService must be bound to the gateway and must have one or more hosts that match the hosts specified in a server. The match could be an exact match or a suffix match with the server’s hosts. For example, if the server’s hosts specifies *.example.com, a VirtualService with hosts dev.example.com or prod.example.com will match. However, a VirtualService with host example.com or newexample.com will not match.
VirtualService 必须绑定到网关，并且必须具有与服务器中指定的主机匹配的一个或多个主机。 匹配可以是与服务器主机的完全匹配或后缀匹配。 例如，如果服务器的主机指定 *.example.com，则主机为 dev.example.com 或 prod.example.com 的 VirtualService 将匹配。 但是，主机为 example.com 或 newexample.com 的 VirtualService 将不匹配。

NOTE: Only virtual services exported to the gateway’s namespace (e.g., exportTo value of *) can be referenced. Private configurations (e.g., exportTo set to .) will not be available. Refer to the exportTo setting in VirtualService, DestinationRule, and ServiceEntry configurations for details.
注意：只能引用导出到网关命名空间的虚拟服务（例如，exportTo 值为 *）。 私有配置（例如，exportTo 设置为 .）将不可用。 有关详细信息，请参阅 VirtualService、DestinationRule 和 ServiceEntry 配置中的 exportTo 设置。

1. port
必选，描述对外开放的端口

2. hosts
必选，gateway对外发布的地址，FQDN域名，支持左侧通配符来进行模糊匹配。

## Port[](https://istio.io/latest/zh/docs/reference/config/networking/gateway/#Port)

Port describes the properties of a specific port of a service.

| Field      | Type     | Description                                                                                                                                                                                                                                                                      | Required |
| ---------- | -------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------- |
| `number`   | `uint32` | A valid non-negative integer port number.                                                                                                                                                                                                                                        | Yes      |
| `protocol` | `string` | The protocol exposed on the port. MUST BE one of HTTP\|HTTPS\|GRPC\|HTTP2\|MONGO\|TCP\|TLS. TLS can be either used to terminate non-HTTP based connections on a specific port or to route traffic based on SNI header to the destination without terminating the TLS connection. | Yes      |
| `name`     | `string` | Label assigned to the port.                                                                                                                                                                                                                                                      | Yes      |

## ServerTLSSettings[](https://istio.io/latest/zh/docs/reference/config/networking/gateway/#ServerTLSSettings)

| Field                   | Type                                                                                                                | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | Required |
| ----------------------- | ------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | -------- |
| `httpsRedirect`         | `bool`                                                                                                              | If set to true, the load balancer will send a 301 redirect for all http connections, asking the clients to use HTTPS.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | No       |
| `mode`                  | `[TLSmode](https://istio.io/latest/zh/docs/reference/config/networking/gateway/#ServerTLSSettings-TLSmode)`         | Optional: Indicates whether connections to this port should be secured using TLS. The value of this field determines how TLS is enforced.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | No       |
| `serverCertificate`     | `string`                                                                                                            | REQUIRED if mode is `SIMPLE` or `MUTUAL`. The path to the file holding the server-side TLS certificate to use.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | No       |
| `privateKey`            | `string`                                                                                                            | REQUIRED if mode is `SIMPLE` or `MUTUAL`. The path to the file holding the server’s private key.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | No       |
| `caCertificates`        | `string`                                                                                                            | REQUIRED if mode is `MUTUAL` or `OPTIONAL_MUTUAL`. The path to a file containing certificate authority certificates to use in verifying a presented client side certificate.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | No       |
| `credentialName`        | `string`                                                                                                            | For gateways running on Kubernetes, the name of the secret that holds the TLS certs including the CA certificates. Applicable only on Kubernetes. An Opaque secret should contain the following keys and values: `key: <privateKey>` and `cert: <serverCert>`. For mutual TLS, `cacert: <CACertificate>` and `crl: <CertificateRevocationList>` can be provided in the same secret or a separate secret named `<secret>-cacert`. A TLS secret for server certificates with an additional `tls.ocsp-staple` key for specifying OCSP staple information, `ca.crt` key for CA certificates and `ca.crl` for certificate revocation list is also supported. Only one of server certificates and CA certificate or credentialName can be specified.         | No       |
| `subjectAltNames`       | `string[]`                                                                                                          | A list of alternate names to verify the subject identity in the certificate presented by the client.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | No       |
| `verifyCertificateSpki` | `string[]`                                                                                                          | An optional list of base64-encoded SHA-256 hashes of the SPKIs of authorized client certificates. Note: When both verify_certificate_hash and verify_certificate_spki are specified, a hash matching either value will result in the certificate being accepted.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | No       |
| `verifyCertificateHash` | `string[]`                                                                                                          | An optional list of hex-encoded SHA-256 hashes of the authorized client certificates. Both simple and colon separated formats are acceptable. Note: When both verify_certificate_hash and verify_certificate_spki are specified, a hash matching either value will result in the certificate being accepted.                                                                                                                                                                                                                                                                                                                                                                                                                                           | No       |
| `minProtocolVersion`    | `[TLSProtocol](https://istio.io/latest/zh/docs/reference/config/networking/gateway/#ServerTLSSettings-TLSProtocol)` | Optional: Minimum TLS protocol version. By default, it is `TLSV1_2`. TLS protocol versions below TLSV1_2 require setting compatible ciphers with the `cipherSuites` setting as they no longer include compatible ciphers.Note: Using TLS protocol versions below TLSV1_2 has serious security risks.                                                                                                                                                                                                                                                                                                                                                                                                                                                   | No       |
| `maxProtocolVersion`    | `[TLSProtocol](https://istio.io/latest/zh/docs/reference/config/networking/gateway/#ServerTLSSettings-TLSProtocol)` | Optional: Maximum TLS protocol version.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | No       |
| `cipherSuites`          | `string[]`                                                                                                          | Optional: If specified, only support the specified cipher list. Otherwise default to the default cipher list supported by Envoy as specified [here](https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/transport_sockets/tls/v3/common.proto). The supported list of ciphers are:<br><br>- `ECDHE-ECDSA-AES128-GCM-SHA256`<br>- `ECDHE-RSA-AES128-GCM-SHA256`<br>- `ECDHE-ECDSA-AES256-GCM-SHA384`<br>- `ECDHE-RSA-AES256-GCM-SHA384`<br>- `ECDHE-ECDSA-CHACHA20-POLY1305`<br>- `ECDHE-RSA-CHACHA20-POLY1305`<br>- `ECDHE-ECDSA-AES128-SHA`<br>- `ECDHE-RSA-AES128-SHA`<br>- `ECDHE-ECDSA-AES256-SHA`<br>- `ECDHE-RSA-AES256-SHA`<br>- `AES128-GCM-SHA256`<br>- `AES256-GCM-SHA384`<br>- `AES128-SHA`<br>- `AES256-SHA`<br>- `DES-CBC3-SHA` | No       |

## ServerTLSSettings.TLSmode[](https://istio.io/latest/zh/docs/reference/config/networking/gateway/#ServerTLSSettings-TLSmode)

TLS modes enforced by the proxy

| Name               | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| ------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `PASSTHROUGH`      | The SNI string presented by the client will be used as the match criterion in a VirtualService TLS route to determine the destination service from the service registry.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `SIMPLE`           | Secure connections with standard TLS semantics. In this mode client certificate is not requested during handshake.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| `MUTUAL`           | Secure connections to the downstream using mutual TLS by presenting server certificates for authentication. A client certificate will also be requested during the handshake and at least one valid certificate is required to be sent by the client.                                                                                                                                                                                                                                                                                                                                                                                                             |
| `AUTO_PASSTHROUGH` | Similar to the passthrough mode, except servers with this TLS mode do not require an associated VirtualService to map from the SNI value to service in the registry. The destination details such as the service/subset/port are encoded in the SNI value. The proxy will forward to the upstream (Envoy) cluster (a group of endpoints) specified by the SNI value. This server is typically used to provide connectivity between services in disparate L3 networks that otherwise do not have direct connectivity between their respective endpoints. Use of this mode assumes that both the source and the destination are using Istio mTLS to secure traffic. |
| `ISTIO_MUTUAL`     | Secure connections from the downstream using mutual TLS by presenting server certificates for authentication. Compared to Mutual mode, this mode uses certificates, representing gateway workload identity, generated automatically by Istio for mTLS authentication. When this mode is used, all other fields in `TLSOptions` should be empty.                                                                                                                                                                                                                                                                                                                   |
| `OPTIONAL_MUTUAL`  | Similar to MUTUAL mode, except that the client certificate is optional. Unlike SIMPLE mode, A client certificate will still be explicitly requested during handshake, but the client is not required to send a certificate. If a client certificate is presented, it will be validated. ca_certificates should be specified for validating client certificates.                                                                                                                                                                                                                                                                                                   |

## ServerTLSSettings.TLSProtocol[](https://istio.io/latest/zh/docs/reference/config/networking/gateway/#ServerTLSSettings-TLSProtocol)

TLS protocol versions.

| Name       | Description                                   |
| ---------- | --------------------------------------------- |
| `TLS_AUTO` | Automatically choose the optimal TLS version. |
| `TLSV1_0`  | TLS version 1.0                               |
| `TLSV1_1`  | TLS version 1.1                               |
| `TLSV1_2`  | TLS version 1.2                               |
| `TLSV1_3`  | TLS version 1.3                               |

[ENVOY FILTER](https://istio.io/latest/zh/docs/reference/config/networking/envoy-filter/ "Customizing Envoy configuration generated by Istio.")

[PROXYCONFIG](https://istio.io/latest/zh/docs/reference/config/networking/proxy-config/ "Provides configuration for individual workloads.")
